#!/usr/bin/env python3
"""
ðŸ—¡ï¸ SICARIUS EXPLOIT v2.0 (Powered by Legion Core)
"""

import sys
import os
from playwright.sync_api import sync_playwright

# Import Legion Core
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '../../..')))
from libs.legion_core import legion_tool, LegionIO

def setup_args(parser):
    parser.add_argument("target", help="Target URL")
    parser.add_argument("--input", action='append', help="selector=value")
    parser.add_argument("--submit", help="Submit selector")
    parser.add_argument("--condition", help="text:value or url:value")
    parser.add_argument("--output", help="Screenshot path")

@legion_tool("Sicarius Browser Exploitation", setup_args)
def main(args):
    url = args.target
    inputs = args.input or []
    condition = args.condition
    screenshot = args.output

    if not url or not condition:
        raise ValueError("URL and Condition are required")

    LegionIO.log(f"Attacking {url}...")
    
    result = {"success": False, "url": url, "logs": []}

    with sync_playwright() as p:
        browser = p.chromium.launch(headless=True)
        page = browser.new_page()
        
        try:
            page.goto(url, timeout=30000)
            
            # Inputs
            for i in inputs:
                sel, val = i.split('=', 1)
                page.fill(sel, val)
            
            # Submit
            if args.submit:
                page.click(args.submit)
                page.wait_for_load_state('networkidle')

            # Check
            cond_type, cond_val = condition.split(':', 1)
            if cond_type == 'text':
                result['success'] = page.get_by_text(cond_val).count() > 0
            elif cond_type == 'url':
                result['success'] = cond_val in page.url

            if screenshot:
                page.screenshot(path=screenshot)
                result['screenshot'] = screenshot

        except Exception as e:
            result['error'] = str(e)
        finally:
            browser.close()

    return result

if __name__ == "__main__":
    main()
